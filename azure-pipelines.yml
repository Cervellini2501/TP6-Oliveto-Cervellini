# TP04 - Pipeline Simple que S√ç funciona
trigger:
  - main

pool:
  name: 'PalabrasPOOL'
  demands:
    - agent.name -equals PalabrasAGENT

stages:
- stage: CI
  displayName: 'Continuous Integration'
  jobs:

  - job: BuildApp
    displayName: 'Build Complete App'
    steps:

    - task: NodeTool@0
      displayName: 'Install Node.js'
      inputs:
        versionSpec: '18.x'

    # Build Frontend
    - script: |
        echo "=== BUILDING FRONTEND ==="
        dir front
        cd front
        npm install
        echo "Frontend dependencies installed"
        npm run build
        echo "Frontend build completed"
      displayName: 'Build Frontend'

    # Build Backend  
    - script: |
        echo "=== BUILDING BACKEND ==="
        dir back
        cd back
        npm install
        echo "Backend dependencies installed"
        npm run build
        echo "Backend build completed"
      displayName: 'Build Backend'

    # Copy and Publish Artifacts
    - task: CopyFiles@2
      displayName: 'Copy All Files'
      inputs:
        Contents: |
          front/**
          back/**
          !**/node_modules/**
        TargetFolder: '$(Build.ArtifactStagingDirectory)'

    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifacts'
      inputs:
        PathtoPublish: '$(Build.ArtifactStagingDirectory)'
        ArtifactName: 'app-complete'