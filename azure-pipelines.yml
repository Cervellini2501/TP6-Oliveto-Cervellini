# TP04 - Azure DevOps Pipeline CI - AplicaciÃ³n de Palabras (Frontend + Backend)
# Ejecuta en un agente Self-Hosted, construye ambos mÃ³dulos y publica artefactos

trigger:
  - main

pool:
  name: 'PalabrasPOOL'
  demands:
    - agent.name -equals PalabrasAGENT

stages:
  - stage: CI
    displayName: 'Continuous Integration'
    jobs:
      - job: BuildApp
        displayName: 'Build Frontend + Backend'
        steps:

          #Instalar Node.js
          - task: NodeTool@0
            displayName: 'Install Node.js 18.x'
            inputs:
              versionSpec: '18.x'

          #=========== Build del Frontend ===========
          - script: |
              echo "ðŸ”§ === BUILDING FRONTEND ==="
              dir front
              cd front
              npm install
              echo "âœ… Frontend dependencies installed"
              npm run build
              echo "âœ… Frontend build completed"
            displayName: 'Frontend - Install & Build'

          #=========== Build del Backend ===========
          - script: |
              echo "ðŸ”§ === BUILDING BACKEND ==="
              dir back
              cd back
              npm install
              echo "âœ… Backend dependencies installed"
              npm run build
              echo "âœ… Backend build completed"
            displayName: 'Backend - Install & Build'

          #Copiar archivos (excepto node_modules)
          - task: CopyFiles@2
            displayName: 'Copy Frontend + Backend files (excluding node_modules)'
            inputs:
              Contents: |
                front/**
                back/**
                !**/node_modules/**
              TargetFolder: '$(Build.ArtifactStagingDirectory)'

          #=========== Publicacion de artefactos ===========
          - task: PublishBuildArtifacts@1
            displayName: 'Publish Combined App Artifacts'
            inputs:
              PathtoPublish: '$(Build.ArtifactStagingDirectory)'
              ArtifactName: 'app-complete'
